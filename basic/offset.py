import numpy as np


def calculate_curvature(p1, p2, p3):
    # 计算三点形成的曲率
    # p1, p2, p3 是 (x, y) 坐标元组
    x1, y1 = p1
    x2, y2 = p2
    x3, y3 = p3

    # 使用叉积计算曲率
    A = np.array([x1, y1])
    B = np.array([x2, y2])
    C = np.array([x3, y3])

    # 计算两向量的叉积的模
    cross_product = np.linalg.norm(np.cross(B - A, C - B))

    # 计算两段线段的长度
    AB = np.linalg.norm(B - A)
    BC = np.linalg.norm(C - B)

    if AB * BC == 0:
        return 0

    # 计算曲率
    curvature = cross_product / (AB * BC)
    return curvature


def calculate_offset(track):
    num_points = len(track)

    if num_points < 3:
        return 0  # 如果轨迹点少于3个，无法计算曲率

    total_curvature = 0
    count = 0

    for i in range(1, num_points - 1):
        p1 = track[i - 1]
        p2 = track[i]
        p3 = track[i + 1]
        total_curvature += calculate_curvature(p1, p2, p3)
        count += 1

    # 返回平均曲率作为轨迹的弯曲程度
    return total_curvature / count if count > 0 else 0


# 示例轨迹
track = [(1183.5094299316406, 1020.6396636962891), (1223.6506958007812, 1010.0387725830078), (1267.9140625, 996.91162109375), (1290.5452270507812, 977.8340759277344), (1323.3363037109375, 944.6018676757812), (1352.05126953125, 890.9883728027344), (1368.3629150390625, 855.7323150634766), (1391.2359008789062, 816.4122772216797), (1416.7423706054688, 778.8036346435547), (1429.2438354492188, 753.2722930908203), (1443.0243530273438, 724.66064453125), (1457.5760498046875, 694.0057830810547), (1466.0227661132812, 675.0654296875), (1478.3959350585938, 651.355598449707), (1492.2428588867188, 628.3918380737305), (1499.9720458984375, 613.6698226928711), (1511.718994140625, 594.5700759887695), (1523.31591796875, 575.7825622558594), (1529.049072265625, 564.5183410644531), (1534.8840942382812, 549.5038070678711), (1540.6676025390625, 533.8770294189453), (1542.8949584960938, 524.2374267578125), (1546.1187133789062, 510.6405563354492), (1547.9238891601562, 497.8500289916992), (1549.8986206054688, 488.1912384033203), (1549.8065795898438, 479.0426483154297), (1549.4285888671875, 465.99317932128906), (1548.6893310546875, 457.61580657958984), (1546.2583618164062, 447.39056396484375), (1543.6426391601562, 437.98817443847656), (1540.8787841796875, 432.93482208251953), (1536.2492065429688, 423.9856948852539), (1530.743896484375, 416.2286376953125), (1527.022705078125, 411.7821731567383), (1521.6465454101562, 403.80916595458984), (1516.338623046875, 398.3800048828125), (1511.4115600585938, 395.9043502807617), (1504.501220703125, 389.7259826660156), (1497.609375, 383.6430969238281), (1493.0879516601562, 378.42893981933594), (1485.4520263671875, 374.36173248291016), (1476.933349609375, 371.65087127685547), (1471.4005737304688, 368.03031158447266), (1462.5975952148438, 364.4853210449219), (1452.9573974609375, 359.15808868408203), (1446.3109741210938, 357.62599182128906), (1437.3426513671875, 349.0562057495117), (1426.8023681640625, 343.5231018066406), (1420.6336669921875, 339.3094711303711), (1411.3129272460938, 334.5410842895508), (1401.4608764648438, 331.77860260009766), (1394.5337524414062, 329.9076385498047), (1393.9425048828125, 327.5948715209961), (1388.2689819335938, 329.1486587524414), (1384.7275390625, 316.3564224243164), (1380.5148315429688, 308.31201934814453), (1380.343017578125, 302.68537521362305), (1380.3412475585938, 299.6933135986328), (1380.5438232421875, 296.5637741088867), (1369.262451171875, 295.63393783569336), (1366.1239013671875, 295.7286567687988), (1363.53955078125, 296.28461837768555), (1362.7174072265625, 296.4539680480957), (1359.209228515625, 298.3039360046387), (1354.677490234375, 299.39778900146484), (1356.2196044921875, 303.22790145874023), (1371.1429443359375, 306.9032211303711), (1375.6299438476562, 315.51247787475586), (1381.044189453125, 316.5828628540039), (1384.3955688476562, 313.6497497558594), (1387.3716430664062, 315.1882781982422), (1391.8118286132812, 317.1173896789551), (1395.1554565429688, 313.4926223754883), (1397.254638671875, 316.7709045410156)]
print("轨迹的弯曲程度:", calculate_offset(track))
